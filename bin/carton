#!/usr/bin/env bash

if [[ -z "$1" ]]; then
  ${EMACS:-emacs} --script $(dirname $(dirname $0))/carton-cli.el -- "$@"
else
  case "$1" in
  version|info|list|package|install|update)
      ${EMACS:-emacs} --script $(dirname $(dirname $0))/carton-cli.el -- "$@"
      ;;
  init)
      ${EMACS:-emacs} --script $(dirname $(dirname $0))/carton-cli.el -- "$@"
      ;;
  exec)
    EMACSLOADPATH=$("$EMACS" -Q --batch --eval '(princ (mapconcat (quote identity) (append (file-expand-wildcards (format ".carton/%s/elpa/*" emacs-version) t) load-path) ":"))' 2>&1) exec "${@:2}"
    ;;
  -h|--help|help)
    ${EMACS:-emacs} --script $(dirname $(dirname $0))/carton-cli.el -- "$@"
    ;;
  esac
fi
